# Phase 3: Media Processing

> üìö **–ù–∞–≤–∏–≥–∞—Ü–∏—è**: [‚Üê Phase 2](phase2_content_parsing.md) | [‚Üê –í—Å–µ —Ñ–∞–∑—ã](../README.md#-–ø—è—Ç–∏—Ñ–∞–∑–Ω—ã–π-–ø–∞–π–ø–ª–∞–π–Ω-–æ–±—Ä–∞–±–æ—Ç–∫–∏) | [‚Üí Phase 4](phase4_wordpress_preparation.md)

## –û–±–∑–æ—Ä
–¢—Ä–µ—Ç—å—è —Ñ–∞–∑–∞ - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –≤–∏–¥–µ–æ) –∏–∑ —Å–ø–∞—Ä—Å–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **ExtractMediaDownloaderPlaywright** (`services/media_processor.py`) - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ wget —Å –±—Ä–∞—É–∑–µ—Ä–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (–∫–ª–∞—Å—Å –Ω–∞–∑–≤–∞–Ω –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç wget, –Ω–µ Playwright API)

## –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### 1. –í—ã–±–æ—Ä–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
```sql
SELECT * FROM media_files 
WHERE status = 'pending' 
AND file_path IS NULL
```

### 2. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `wget` —Å –±—Ä–∞—É–∑–µ—Ä–Ω—ã–º–∏ User-Agent –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- –ù–µ–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º: 1 —Ñ–∞–π–ª –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ  
- –°–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏ (2-5 —Å–µ–∫)
- Timeout: 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ñ–∞–π–ª
- –ë–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤ (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑)

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–æ!)
```python
# –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
MIN_FILE_SIZE = 3 * 1024       # 3 –ö–ë –º–∏–Ω–∏–º—É–º
MAX_FILE_SIZE = 2 * 1024 * 1024 # 2 –ú–ë –º–∞–∫—Å–∏–º—É–º

# –†–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (NEW!)
MIN_IMAGE_WIDTH = 300   # –º–∏–Ω–∏–º—É–º 300px
MIN_IMAGE_HEIGHT = 300  # –º–∏–Ω–∏–º—É–º 300px
```

### 4. –ü—Ä–æ—Ü–µ—Å—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞**: 3 –ö–ë - 2 –ú–ë
2. **–î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ PIL
   ```python
   with Image.open(file_path) as img:
       width, height = img.size
       if width < 300 or height < 300:
           # –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª
           os.remove(file_path)
           raise Exception("–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–æ–µ")
   ```

### 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
```sql
UPDATE media_files SET
    file_path = ?,
    file_size = ?,
    type = ?,
    width = ?,      -- NEW!
    height = ?,     -- NEW!
    status = 'completed'
WHERE media_id = ?
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫
```
data/media/
‚îú‚îÄ‚îÄ {article_id[:8]}/
‚îÇ   ‚îú‚îÄ‚îÄ {hash1}.jpg
‚îÇ   ‚îú‚îÄ‚îÄ {hash2}.png
‚îÇ   ‚îî‚îÄ‚îÄ ...
```

## –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
```bash
python core/main.py --media-only
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: –ø–æ URL —Ö–µ—à—É  
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è**: –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑ URL
- **–¢–∏–ø—ã**: image (jpg, png, webp) –∏ video (mp4, webm)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –æ–±—Ö–æ–¥ –∑–∞—â–∏—Ç —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –æ–¥–∏–Ω —Ñ–∞–π–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- **–°—Ç–∞—Ç—É—Å—ã**: 'pending' ‚Üí 'completed' –∏–ª–∏ 'failed' —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏—á–∏–Ω–∞–º–∏

## –ú–µ—Ç—Ä–∏–∫–∏
- –°–∫–∞—á–∞–Ω–æ —Ñ–∞–π–ª–æ–≤
- –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –ø–æ —Ä–∞–∑–º–µ—Ä—É
- –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –ø–æ dimensions
- –û—à–∏–±–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –º–µ–¥–∏–∞